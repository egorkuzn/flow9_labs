import runtime;
import sys/system;
import third_block/lib/nemo_ast;
import third_block/lib/nemo_typecheck;

main () {
    rpoc = \file -> {
        src = getFileContent(file);
        prog = s2nm(src);
        err_count = ref 0;

        err = \msg -> {
            err_count := ^err_count + 1;
            println(msg);
        }

        typecheckNmProgram(prog, err);

        if (^err_count == 0) {
            println("nemo prog " + file + ":");
            println(nmProg2s(prog));

            println("prog");
            println(prog);
        }
    }

    rpoc("C:/Users/egork/source/flow9/labs/third_block/test/test1.nm");
    println("\nAnother step:\n");
    rpoc("C:/Users/egork/source/flow9/labs/third_block/test/test2.nm");
    quit(0);
}